<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="SistemaParamedicosDemo4.MVVM.Views.InventarioView"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:SistemaParamedicosDemo4.MVVM.ViewModels"
             Title="Inventario de ParamÃ©dicos"
             BackgroundColor="#F5F7FA">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="PrimaryColor">#2E86AB</Color>
            <Color x:Key="SecondaryColor">#17A2B8</Color>
            <Color x:Key="SuccessColor">#28A745</Color>
            <Color x:Key="DangerColor">#DC3545</Color>
            <Color x:Key="WarningColor">#FFC107</Color>
            <Color x:Key="LightGray">#F8F9FA</Color>
            <Color x:Key="MediumGray">#6C757D</Color>
            <Color x:Key="DarkGray">#343A40</Color>
            <Color x:Key="BorderColor">#DEE2E6</Color>

            <Style x:Key="CardStyle" TargetType="Border">
                <Setter Property="BackgroundColor" Value="White"/>
                <Setter Property="StrokeThickness" Value="1"/>
                <Setter Property="Stroke" Value="{StaticResource BorderColor}"/>
                <Setter Property="StrokeShape" Value="RoundRectangle 8"/>
                <Setter Property="Padding" Value="15"/>
                <Setter Property="Margin" Value="5"/>
                <Setter Property="Shadow">
                    <Setter.Value>
                        <Shadow Brush="Gray" Opacity="0.15" Radius="6" Offset="0,2"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="HeaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="24"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="TextColor" Value="{StaticResource DarkGray}"/>
                <Setter Property="Margin" Value="0,0,0,5"/>
            </Style>

            <Style x:Key="SubHeaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="TextColor" Value="{StaticResource DarkGray}"/>
            </Style>

            <Style x:Key="BodyStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="TextColor" Value="{StaticResource MediumGray}"/>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <ScrollView>
            <StackLayout>
                <StackLayout.Padding>
                    <OnIdiom x:TypeArguments="Thickness">
                        <OnIdiom.Phone>10</OnIdiom.Phone>
                        <OnIdiom.Tablet>20</OnIdiom.Tablet>
                        <OnIdiom.Desktop>20</OnIdiom.Desktop>
                    </OnIdiom>
                </StackLayout.Padding>

                <StackLayout Margin="0,0,0,15">
                    <Label Text="Inventario de ParamÃ©dicos" Style="{StaticResource HeaderStyle}">
                        <Label.FontSize>
                            <OnIdiom x:TypeArguments="x:Double">
                                <OnIdiom.Phone>20</OnIdiom.Phone>
                                <OnIdiom.Tablet>24</OnIdiom.Tablet>
                                <OnIdiom.Desktop>24</OnIdiom.Desktop>
                            </OnIdiom>
                        </Label.FontSize>
                    </Label>
                    <Label Text="GestiÃ³n de existencias del almacÃ©n ALM6 - ActualizaciÃ³n AutomÃ¡tica" Style="{StaticResource BodyStyle}" FontSize="12">
                        <Label.IsVisible>
                            <OnIdiom x:TypeArguments="x:Boolean">
                                <OnIdiom.Phone>False</OnIdiom.Phone>
                                <OnIdiom.Tablet>True</OnIdiom.Tablet>
                                <OnIdiom.Desktop>True</OnIdiom.Desktop>
                            </OnIdiom>
                        </Label.IsVisible>
                    </Label>
                </StackLayout>

                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Column="0" Grid.Row="0" BackgroundColor="White" StrokeThickness="1" Stroke="{StaticResource BorderColor}" StrokeShape="RoundRectangle 12" Padding="12,10" Margin="2">
                        <StackLayout Spacing="3">
                            <Label Text="ðŸ“¦" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding TotalProductos}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource PrimaryColor}" HorizontalOptions="Center"/>
                            <Label Text="Total" FontSize="11" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center"/>
                        </StackLayout>
                    </Border>

                    <Border Grid.Column="1" Grid.Row="0" BackgroundColor="White" StrokeThickness="1" Stroke="{StaticResource SuccessColor}" StrokeShape="RoundRectangle 12" Padding="12,10" Margin="2">
                        <StackLayout Spacing="3">
                            <Label Text="âœ…" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding ProductosDisponibles}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource SuccessColor}" HorizontalOptions="Center"/>
                            <Label Text="Disponibles" FontSize="11" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center"/>
                        </StackLayout>
                    </Border>

                    <Border Grid.Column="2" Grid.Row="0" BackgroundColor="White" StrokeThickness="1" Stroke="{StaticResource WarningColor}" StrokeShape="RoundRectangle 12" Padding="12,10" Margin="2">
                        <Border.IsVisible>
                            <OnIdiom x:TypeArguments="x:Boolean">
                                <OnIdiom.Phone>False</OnIdiom.Phone>
                                <OnIdiom.Tablet>True</OnIdiom.Tablet>
                                <OnIdiom.Desktop>True</OnIdiom.Desktop>
                            </OnIdiom>
                        </Border.IsVisible>
                        <StackLayout Spacing="3">
                            <Label Text="âš ï¸" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding ProductosStockBajo}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource WarningColor}" HorizontalOptions="Center"/>
                            <Label Text="Stock Bajo" FontSize="11" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center"/>
                        </StackLayout>
                    </Border>

                    <Border Grid.Column="3" Grid.Row="0" BackgroundColor="White" StrokeThickness="1" Stroke="{StaticResource DangerColor}" StrokeShape="RoundRectangle 12" Padding="12,10" Margin="2">
                        <Border.IsVisible>
                            <OnIdiom x:TypeArguments="x:Boolean">
                                <OnIdiom.Phone>False</OnIdiom.Phone>
                                <OnIdiom.Tablet>True</OnIdiom.Tablet>
                                <OnIdiom.Desktop>True</OnIdiom.Desktop>
                            </OnIdiom>
                        </Border.IsVisible>
                        <StackLayout Spacing="3">
                            <Label Text="âŒ" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding ProductosAgotados}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource DangerColor}" HorizontalOptions="Center"/>
                            <Label Text="Agotados" FontSize="11" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center"/>
                        </StackLayout>
                    </Border>

                    <Border Grid.Column="0" Grid.Row="1" BackgroundColor="White" StrokeThickness="1" Stroke="{StaticResource WarningColor}" StrokeShape="RoundRectangle 12" Padding="12,10" Margin="2">
                        <Border.IsVisible>
                            <OnIdiom x:TypeArguments="x:Boolean">
                                <OnIdiom.Phone>True</OnIdiom.Phone>
                                <OnIdiom.Tablet>False</OnIdiom.Tablet>
                                <OnIdiom.Desktop>False</OnIdiom.Desktop>
                            </OnIdiom>
                        </Border.IsVisible>
                        <StackLayout Spacing="3">
                            <Label Text="âš ï¸" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding ProductosStockBajo}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource WarningColor}" HorizontalOptions="Center"/>
                            <Label Text="Stock Bajo" FontSize="11" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center"/>
                        </StackLayout>
                    </Border>

                    <Border Grid.Column="1" Grid.Row="1" BackgroundColor="White" StrokeThickness="1" Stroke="{StaticResource DangerColor}" StrokeShape="RoundRectangle 12" Padding="12,10" Margin="2">
                        <Border.IsVisible>
                            <OnIdiom x:TypeArguments="x:Boolean">
                                <OnIdiom.Phone>True</OnIdiom.Phone>
                                <OnIdiom.Tablet>False</OnIdiom.Tablet>
                                <OnIdiom.Desktop>False</OnIdiom.Desktop>
                            </OnIdiom>
                        </Border.IsVisible>
                        <StackLayout Spacing="3">
                            <Label Text="âŒ" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding ProductosAgotados}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource DangerColor}" HorizontalOptions="Center"/>
                            <Label Text="Agotados" FontSize="11" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center"/>
                        </StackLayout>
                    </Border>
                </Grid>

                <Border Style="{StaticResource CardStyle}">
                    <StackLayout>
                        <Label Text="ðŸ” Buscar producto:" Style="{StaticResource BodyStyle}" FontSize="12" Margin="0,0,0,5"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <SearchBar Grid.Column="0" Text="{Binding TextoBusqueda}" Placeholder="Buscar por nombre, cÃ³digo..." SearchCommand="{Binding BuscarCommand}" BackgroundColor="White" TextColor="{StaticResource DarkGray}" PlaceholderColor="{StaticResource MediumGray}"/>
                            <Button Grid.Column="1" Text="âœ•" Command="{Binding LimpiarBusquedaCommand}" BackgroundColor="{StaticResource DangerColor}" TextColor="White" CornerRadius="6" Padding="12,0" Margin="8,0,0,0" IsVisible="{Binding TextoBusqueda}"/>
                        </Grid>

                        <Label Text="ðŸŽ¯ Filtrar por:" Style="{StaticResource BodyStyle}" FontSize="12" Margin="0,12,0,5"/>
                        <FlexLayout Wrap="Wrap" JustifyContent="Start" AlignItems="Center">
                            <Button Text="Todos" Command="{Binding AplicarFiltroCommand}" CommandParameter="Todos" BackgroundColor="{StaticResource PrimaryColor}" TextColor="White" CornerRadius="20" Padding="15,6" FontSize="12" Margin="3"/>
                            <Button Text="âœ… Disponibles" Command="{Binding AplicarFiltroCommand}" CommandParameter="Disponibles" BackgroundColor="{StaticResource SuccessColor}" TextColor="White" CornerRadius="20" Padding="15,6" FontSize="12" Margin="3"/>
                            <Button Text="âš ï¸ Stock Bajo" Command="{Binding AplicarFiltroCommand}" CommandParameter="Stock Bajo" BackgroundColor="{StaticResource WarningColor}" TextColor="White" CornerRadius="20" Padding="15,6" FontSize="12" Margin="3"/>
                            <Button Text="âŒ Agotados" Command="{Binding AplicarFiltroCommand}" CommandParameter="Agotados" BackgroundColor="{StaticResource DangerColor}" TextColor="White" CornerRadius="20" Padding="15,6" FontSize="12" Margin="3"/>
                        </FlexLayout>

                        <Label Text="{Binding MensajeEstado}" Style="{StaticResource BodyStyle}" FontSize="11" HorizontalOptions="Center" Margin="0,10,0,0"/>

                        <ActivityIndicator IsRunning="{Binding IsCargando}" IsVisible="{Binding IsCargando}" Color="{StaticResource PrimaryColor}" Margin="0,10,0,0"/>
                    </StackLayout>
                </Border>

                <Border Style="{StaticResource CardStyle}" Padding="10">
                    <StackLayout>
                        <Label Text="Productos del inventario:" Style="{StaticResource SubHeaderStyle}" FontSize="14" Margin="5,5,5,10"/>
                        <CollectionView ItemsSource="{Binding ProductosInventario}" SelectionMode="None">
                            <CollectionView.EmptyView>
                                <StackLayout Padding="50" VerticalOptions="Center">
                                    <Label Text="ðŸ“¦" FontSize="48" HorizontalOptions="Center"/>
                                    <Label Text="No se encontraron productos" FontSize="18" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center" Margin="0,10,0,0"/>
                                </StackLayout>
                            </CollectionView.EmptyView>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border BackgroundColor="White" StrokeThickness="1" Stroke="{StaticResource BorderColor}" StrokeShape="RoundRectangle 8" Padding="12" Margin="5">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="70"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <Border Grid.Row="0" Grid.RowSpan="3" Grid.Column="0" BackgroundColor="{StaticResource LightGray}" StrokeThickness="1" Stroke="{StaticResource BorderColor}" StrokeShape="RoundRectangle 8" WidthRequest="60" HeightRequest="60" VerticalOptions="Start" Margin="0,0,12,0">
                                                <Grid>
                                                    <Label Text="ðŸ“¦" FontSize="30" HorizontalOptions="Center" VerticalOptions="Center" Opacity="0.3" IsVisible="{Binding TieneFoto}"/>
                                                    <Image Source="{Binding FotoUrl}" Aspect="AspectFill" HorizontalOptions="Center" VerticalOptions="Center" IsVisible="{Binding TieneFoto}"/>
                                                </Grid>
                                            </Border>

                                            <Label Grid.Row="0" Grid.Column="1" Text="{Binding NombreDelProducto}" FontSize="14" FontAttributes="Bold" TextColor="{StaticResource DarkGray}" LineBreakMode="TailTruncation" MaxLines="2"/>

                                            <Border Grid.Row="0" Grid.Column="2" BackgroundColor="{Binding ColorStock}" StrokeThickness="0" StrokeShape="RoundRectangle 10" Padding="8,4" VerticalOptions="Start">
                                                <Label Text="{Binding EstadoStock}" TextColor="White" FontSize="10" FontAttributes="Bold"/>
                                            </Border>

                                            <HorizontalStackLayout Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" Spacing="10" Margin="0,6,0,0">
                                                <Label Text="{Binding Producto, StringFormat='CÃ³digo: {0}'}" Style="{StaticResource BodyStyle}" FontSize="11"/>
                                                <Label Text="{Binding Marca, StringFormat='â€¢ {0}'}" Style="{StaticResource BodyStyle}" FontSize="11" FontAttributes="Bold" IsVisible="{Binding Marca}"/>
                                            </HorizontalStackLayout>

                                            <Grid Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2" ColumnSpacing="12" Margin="0,10,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <StackLayout Grid.Column="0" Spacing="2">
                                                    <Label Text="Entradas" FontSize="10" TextColor="{StaticResource MediumGray}"/>
                                                    <Label Text="{Binding Entrada, StringFormat='{0:F0}'}" FontSize="15" FontAttributes="Bold" TextColor="{StaticResource SuccessColor}"/>
                                                </StackLayout>
                                                <StackLayout Grid.Column="1" Spacing="2">
                                                    <Label Text="Salidas" FontSize="10" TextColor="{StaticResource MediumGray}"/>
                                                    <Label Text="{Binding Salida, StringFormat='{0:F0}'}" FontSize="15" FontAttributes="Bold" TextColor="{StaticResource DangerColor}"/>
                                                </StackLayout>
                                                <StackLayout Grid.Column="2" Spacing="2">
                                                    <Label Text="Existencia" FontSize="10" TextColor="{StaticResource MediumGray}"/>
                                                    <Label Text="{Binding Existencia, StringFormat='{0:F0}'}" FontSize="18" FontAttributes="Bold" TextColor="{StaticResource PrimaryColor}"/>
                                                </StackLayout>
                                            </Grid>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </StackLayout>
                </Border>
            </StackLayout>
        </ScrollView>
    </Grid>
</ContentPage>