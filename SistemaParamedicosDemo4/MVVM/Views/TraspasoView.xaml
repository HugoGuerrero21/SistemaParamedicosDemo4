<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="SistemaParamedicosDemo4.MVVM.Views.TraspasoView"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:SistemaParamedicosDemo4.MVVM.ViewModels"
             Title="RecepciÃ³n de Traspasos"
             BackgroundColor="#F5F7FA">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="PrimaryColor">#2E86AB</Color>
            <Color x:Key="SecondaryColor">#17A2B8</Color>
            <Color x:Key="SuccessColor">#28A745</Color>
            <Color x:Key="DangerColor">#DC3545</Color>
            <Color x:Key="WarningColor">#FFC107</Color>
            <Color x:Key="LightGray">#F8F9FA</Color>
            <Color x:Key="MediumGray">#6C757D</Color>
            <Color x:Key="DarkGray">#343A40</Color>
            <Color x:Key="BorderColor">#DEE2E6</Color>

            <Style x:Key="CardStyle" TargetType="Border">
                <Setter Property="BackgroundColor" Value="White"/>
                <Setter Property="StrokeThickness" Value="1"/>
                <Setter Property="Stroke" Value="{StaticResource BorderColor}"/>
                <Setter Property="StrokeShape" Value="RoundRectangle 8"/>
                <Setter Property="Padding" Value="15"/>
                <Setter Property="Margin" Value="5"/>
                <Setter Property="Shadow">
                    <Setter.Value>
                        <Shadow Brush="Gray" Opacity="0.15" Radius="6" Offset="0,2"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="HeaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="24"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="TextColor" Value="{StaticResource DarkGray}"/>
                <Setter Property="Margin" Value="0,0,0,5"/>
            </Style>

            <Style x:Key="SubHeaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="TextColor" Value="{StaticResource DarkGray}"/>
            </Style>

            <Style x:Key="BodyStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="TextColor" Value="{StaticResource MediumGray}"/>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <ScrollView>
            <StackLayout>
                <StackLayout.Padding>
                    <OnIdiom x:TypeArguments="Thickness">
                        <OnIdiom.Phone>10</OnIdiom.Phone>
                        <OnIdiom.Tablet>20</OnIdiom.Tablet>
                        <OnIdiom.Desktop>20</OnIdiom.Desktop>
                    </OnIdiom>
                </StackLayout.Padding>

                <Grid Margin="0,0,0,15">
                    <StackLayout>
                        <Label Text="RecepciÃ³n de Traspasos" Style="{StaticResource HeaderStyle}">
                            <Label.FontSize>
                                <OnIdiom x:TypeArguments="x:Double">
                                    <OnIdiom.Phone>20</OnIdiom.Phone>
                                    <OnIdiom.Tablet>24</OnIdiom.Tablet>
                                    <OnIdiom.Desktop>24</OnIdiom.Desktop>
                                </OnIdiom>
                            </Label.FontSize>
                        </Label>
                        <Label Text="GestiÃ³n de traspasos desde Hermosillo (ALM1) hacia ParamÃ©dicos (ALM6) - ActualizaciÃ³n Auto" 
                               Style="{StaticResource BodyStyle}"
                               FontSize="12"/>
                    </StackLayout>
                </Grid>

                <Border BackgroundColor="White" StrokeThickness="1" Stroke="#DEE2E6" StrokeShape="RoundRectangle 10" Padding="5" Margin="0,0,0,15">
                    <Grid ColumnSpacing="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Text="ðŸ“¦ Pendientes" Command="{Binding CambiarVistaPendientesCommand}" BackgroundColor="{Binding ColorTabPendientes}" TextColor="{Binding ColorTextoTabPendientes}" CornerRadius="8" FontSize="13" FontAttributes="Bold" HeightRequest="45"/>
                        <Button Grid.Column="1" Text="ðŸ“‹ Historial" Command="{Binding CambiarVistaHistorialCommand}" BackgroundColor="{Binding ColorTabHistorial}" TextColor="{Binding ColorTextoTabHistorial}" CornerRadius="8" FontSize="13" FontAttributes="Bold" HeightRequest="45"/>
                    </Grid>
                </Border>

                <Grid Margin="0,0,0,15" IsVisible="{Binding MostrandoPendientes}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" BackgroundColor="White" StrokeThickness="1" Stroke="{StaticResource BorderColor}" StrokeShape="RoundRectangle 12" Padding="12,10" Margin="2">
                        <StackLayout Spacing="3">
                            <Label Text="ðŸ“¦" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding TotalTraspasos}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource PrimaryColor}" HorizontalOptions="Center"/>
                            <Label Text="Traspasos" FontSize="11" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center"/>
                        </StackLayout>
                    </Border>

                    <Border Grid.Column="1" BackgroundColor="White" StrokeThickness="1" Stroke="{StaticResource PrimaryColor}" StrokeShape="RoundRectangle 12" Padding="12,10" Margin="2">
                        <StackLayout Spacing="3">
                            <Label Text="ðŸ“‹" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding ProductosTotales}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource PrimaryColor}" HorizontalOptions="Center"/>
                            <Label Text="Productos" FontSize="11" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center"/>
                        </StackLayout>
                    </Border>

                    <Border Grid.Column="2" BackgroundColor="White" StrokeThickness="1" Stroke="{StaticResource SuccessColor}" StrokeShape="RoundRectangle 12" Padding="12,10" Margin="2">
                        <StackLayout Spacing="3">
                            <Label Text="âœ…" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding ProductosCompletados}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource SuccessColor}" HorizontalOptions="Center"/>
                            <Label Text="Recibidos" FontSize="11" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center"/>
                        </StackLayout>
                    </Border>

                    <Border Grid.Column="3" BackgroundColor="White" StrokeThickness="1" Stroke="{StaticResource WarningColor}" StrokeShape="RoundRectangle 12" Padding="12,10" Margin="2">
                        <StackLayout Spacing="3">
                            <Label Text="â³" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding ProductosPendientes}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource WarningColor}" HorizontalOptions="Center"/>
                            <Label Text="Pendientes" FontSize="11" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center"/>
                        </StackLayout>
                    </Border>
                </Grid>

                <Label Text="{Binding MensajeEstado}" Style="{StaticResource BodyStyle}" FontSize="12" HorizontalOptions="Center" Margin="0,0,0,10" IsVisible="{Binding MensajeEstado}"/>

                <ActivityIndicator IsRunning="{Binding IsCargando}" IsVisible="{Binding IsCargando}" Color="{StaticResource PrimaryColor}" Margin="0,10,0,10"/>

                <CollectionView ItemsSource="{Binding TraspasosPendientes}" SelectionMode="None">
                    <CollectionView.EmptyView>
                        <StackLayout Padding="50" VerticalOptions="Center">
                            <Label Text="ðŸ“¦" FontSize="48" HorizontalOptions="Center"/>
                            <Label Text="No hay traspasos pendientes" FontSize="18" TextColor="{StaticResource MediumGray}" HorizontalOptions="Center" Margin="0,10,0,0"/>
                        </StackLayout>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource CardStyle}" Padding="15" Margin="0,0,0,10">
                                <StackLayout>
                                    <Grid>
                                        <Grid.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ToggleDetalleCommand}" CommandParameter="{Binding .}"/>
                                        </Grid.GestureRecognizers>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <Label Grid.Column="0" Text="{Binding IconoExpandir}" FontSize="20" TextColor="{StaticResource PrimaryColor}" VerticalOptions="Center" Margin="0,0,10,0"/>

                                        <StackLayout Grid.Column="1" Spacing="5">
                                            <Label Text="{Binding IdTraspaso, StringFormat='Traspaso: {0}'}" Style="{StaticResource SubHeaderStyle}" FontSize="16"/>
                                            <StackLayout Spacing="3">
                                                <Label Text="{Binding NombreAlmacenOrigen, StringFormat='Origen: {0}'}" FontSize="11" TextColor="{StaticResource MediumGray}"/>
                                                <Label Text="{Binding NombreChofer, StringFormat='Chofer: {0}'}" FontSize="11" TextColor="{StaticResource MediumGray}"/>
                                                <Label Text="{Binding ProgresoTexto, StringFormat='Progreso: {0}'}" FontSize="11" TextColor="{StaticResource SuccessColor}" FontAttributes="Bold"/>
                                            </StackLayout>
                                        </StackLayout>

                                        <Border Grid.Column="2" BackgroundColor="{Binding ColorStatus}" StrokeThickness="0" StrokeShape="RoundRectangle 12" Padding="10,5" VerticalOptions="Start">
                                            <Label Text="{Binding StatusTexto}" TextColor="White" FontSize="11" FontAttributes="Bold"/>
                                        </Border>
                                    </Grid>

                                    <StackLayout IsVisible="{Binding Expandido}" Margin="0,15,0,0">

                                        <Border BackgroundColor="#F8F9FA" StrokeThickness="1" Stroke="#DEE2E6" StrokeShape="RoundRectangle 8" Padding="0">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>

                                                <Grid Grid.Row="0" BackgroundColor="#343A40" Padding="12,10">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="100"/>
                                                        <ColumnDefinition Width="2*"/>
                                                        <ColumnDefinition Width="80"/>
                                                        <ColumnDefinition Width="80"/>
                                                        <ColumnDefinition Width="80"/>
                                                        <ColumnDefinition Width="100"/>
                                                        <ColumnDefinition Width="90"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Label Grid.Column="0" Text="Clave" TextColor="White" FontSize="12" FontAttributes="Bold" VerticalOptions="Center"/>
                                                    <Label Grid.Column="1" Text="Producto" TextColor="White" FontSize="12" FontAttributes="Bold" VerticalOptions="Center"/>
                                                    <Label Grid.Column="2" Text="Solicitada" TextColor="White" FontSize="12" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center"/>
                                                    <Label Grid.Column="3" Text="Recibida" TextColor="White" FontSize="12" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center"/>
                                                    <Label Grid.Column="4" Text="Faltante" TextColor="White" FontSize="12" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center"/>
                                                    <Label Grid.Column="5" Text="Estado" TextColor="White" FontSize="12" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center"/>
                                                    <Label Grid.Column="6" Text="AcciÃ³n" TextColor="White" FontSize="12" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center"/>
                                                </Grid>

                                                <CollectionView Grid.Row="1" ItemsSource="{Binding Detalles}" SelectionMode="None">
                                                    <CollectionView.ItemTemplate>
                                                        <DataTemplate>
                                                            <Grid BackgroundColor="White" Padding="12,15">
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="100"/>
                                                                    <ColumnDefinition Width="2*"/>
                                                                    <ColumnDefinition Width="80"/>
                                                                    <ColumnDefinition Width="80"/>
                                                                    <ColumnDefinition Width="80"/>
                                                                    <ColumnDefinition Width="100"/>
                                                                    <ColumnDefinition Width="90"/>
                                                                </Grid.ColumnDefinitions>

                                                                <Label Grid.Column="0" Text="{Binding IdProducto}" FontSize="11" TextColor="#343A40" FontAttributes="Bold" VerticalOptions="Center"/>
                                                                <Label Grid.Column="1" Text="{Binding NombreCompletoProducto}" FontSize="11" TextColor="#343A40" VerticalOptions="Center" LineBreakMode="WordWrap" Margin="5,0"/>
                                                                <Label Grid.Column="2" Text="{Binding Cantidad, StringFormat='{0:F0}'}" FontSize="13" FontAttributes="Bold" TextColor="#343A40" HorizontalOptions="Center" VerticalOptions="Center"/>
                                                                <Label Grid.Column="3" Text="{Binding CantidadRecibida, StringFormat='{0:F0}'}" FontSize="13" FontAttributes="Bold" TextColor="#28A745" HorizontalOptions="Center" VerticalOptions="Center"/>
                                                                <Label Grid.Column="4" Text="{Binding CantidadFaltante, StringFormat='{0:F0}'}" FontSize="13" FontAttributes="Bold" TextColor="#FFC107" HorizontalOptions="Center" VerticalOptions="Center"/>

                                                                <Border Grid.Column="5" BackgroundColor="{Binding ColorEstado}" StrokeThickness="0" StrokeShape="RoundRectangle 12" Padding="8,5" HorizontalOptions="Center" VerticalOptions="Center">
                                                                    <Label Text="{Binding TextoEstado}" TextColor="White" FontSize="10" FontAttributes="Bold"/>
                                                                </Border>

                                                                <HorizontalStackLayout Grid.Column="6" Spacing="6" HorizontalOptions="Center" VerticalOptions="Center" IsVisible="{Binding MostrarBotonesAccion}">
                                                                    <Button Text="âœ“" 
                                                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ConfirmarRecepcionCommand}" 
                                                                            CommandParameter="{Binding .}" 
                                                                            BackgroundColor="#28A745" 
                                                                            TextColor="White" 
                                                                            CornerRadius="6" 
                                                                            WidthRequest="32" 
                                                                            HeightRequest="32" 
                                                                            FontSize="16" 
                                                                            Padding="0"/>

                                                                    <Button Text="âœ•" 
                                                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.RechazarRecepcionCommand}" 
                                                                            CommandParameter="{Binding .}" 
                                                                            BackgroundColor="#DC3545" 
                                                                            TextColor="White" 
                                                                            CornerRadius="6" 
                                                                            WidthRequest="32" 
                                                                            HeightRequest="32" 
                                                                            FontSize="16" 
                                                                            Padding="0"/>
                                                                </HorizontalStackLayout>
                                                            </Grid>
                                                        </DataTemplate>
                                                    </CollectionView.ItemTemplate>
                                                </CollectionView>
                                            </Grid>
                                        </Border>
                                    </StackLayout>
                                </StackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </StackLayout>
        </ScrollView>
    </Grid>
</ContentPage>