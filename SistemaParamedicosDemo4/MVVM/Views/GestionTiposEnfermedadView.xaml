<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="SistemaParamedicosDemo4.MVVM.Views.GestionTiposEnfermedadView"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:SistemaParamedicosDemo4.Converters"
             Title="GestiÃ³n de Tipos de Enfermedad"
             BackgroundColor="#F5F7FA">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- â­ AGREGAR EL CONVERTIDOR -->
            <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>

            <Color x:Key="PrimaryColor">#2E86AB</Color>
            <Color x:Key="DarkGray">#343A40</Color>
            <Color x:Key="MediumGray">#6C757D</Color>
            <Color x:Key="LightGray">#F8F9FA</Color>
            <Color x:Key="BorderColor">#DEE2E6</Color>
            <Color x:Key="SuccessColor">#28A745</Color>

            <Style x:Key="CardStyle" TargetType="Border">
                <Setter Property="BackgroundColor" Value="White"/>
                <Setter Property="StrokeThickness" Value="1"/>
                <Setter Property="Stroke" Value="{StaticResource BorderColor}"/>
                <Setter Property="StrokeShape" Value="RoundRectangle 12"/>
                <Setter Property="Padding" Value="15"/>
                <Setter Property="Margin" Value="10,5"/>
                <Setter Property="Shadow">
                    <Setter.Value>
                        <Shadow Brush="Gray" Opacity="0.1" Radius="8" Offset="0,2"/>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Padding="20" Spacing="15">

            <!-- Header con estadÃ­sticas -->
            <Border BackgroundColor="White"
                    StrokeThickness="1"
                    Stroke="{StaticResource BorderColor}"
                    StrokeShape="RoundRectangle 12"
                    Padding="20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Icono -->
                    <Border Grid.Column="0"
                            BackgroundColor="{StaticResource PrimaryColor}"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 25"
                            WidthRequest="50"
                            HeightRequest="50"
                            VerticalOptions="Center">
                        <Label Text="ðŸ¥"
                               FontSize="28"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>
                    </Border>

                    <!-- InformaciÃ³n -->
                    <StackLayout Grid.Column="1" 
                                 Spacing="5" 
                                 Margin="15,0"
                                 VerticalOptions="Center">
                        <Label Text="Tipos de Enfermedad"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{StaticResource DarkGray}"/>
                        <Label Text="{Binding MensajeEstado}"
                               FontSize="13"
                               TextColor="{StaticResource MediumGray}"/>
                    </StackLayout>

                    <!-- Total -->
                    <Border Grid.Column="2"
                            BackgroundColor="#E3F2FD"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 20"
                            Padding="15,8"
                            VerticalOptions="Center">
                        <Label Text="{Binding TotalTipos}"
                               FontSize="24"
                               FontAttributes="Bold"
                               TextColor="#2196F3"/>
                    </Border>
                </Grid>
            </Border>

            <!-- BotÃ³n Nuevo Tipo -->
            <Button Text="âž• NUEVO TIPO DE ENFERMEDAD"
                    Command="{Binding MostrarFormularioCommand}"
                    BackgroundColor="{StaticResource SuccessColor}"
                    TextColor="White"
                    FontAttributes="Bold"
                    CornerRadius="8"
                    Padding="15"
                    IsVisible="{Binding MostrarFormulario, Converter={StaticResource InverseBoolConverter}}"/>

            <!-- Formulario para crear nuevo tipo -->
            <Border IsVisible="{Binding MostrarFormulario}"
                    BackgroundColor="#FFF3CD"
                    StrokeThickness="2"
                    Stroke="#FFC107"
                    StrokeShape="RoundRectangle 12"
                    Padding="20">
                <StackLayout Spacing="15">
                    <Label Text="âš ï¸ Nuevo Tipo de Enfermedad"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="#856404"/>

                    <Label Text="Una vez creado, este tipo NO podrÃ¡ ser eliminado. AsegÃºrese de escribir el nombre correctamente."
                           FontSize="13"
                           TextColor="#856404"
                           LineBreakMode="WordWrap"/>

                    <!-- Campo de texto -->
                    <Border BackgroundColor="White"
                            StrokeThickness="2"
                            Stroke="{StaticResource PrimaryColor}"
                            StrokeShape="RoundRectangle 8"
                            Padding="5">
                        <Entry Placeholder="Nombre del tipo de enfermedad"
                               Text="{Binding NuevoTipoNombre}"
                               FontSize="16"
                               BackgroundColor="Transparent"
                               TextColor="Black"/>
                    </Border>

                    <!-- Botones -->
                    <Grid ColumnSpacing="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                Text="CANCELAR"
                                Command="{Binding CancelarCommand}"
                                BackgroundColor="{StaticResource MediumGray}"
                                TextColor="White"
                                FontAttributes="Bold"
                                CornerRadius="8"/>

                        <Button Grid.Column="1"
                                Text="GUARDAR"
                                Command="{Binding GuardarTipoCommand}"
                                BackgroundColor="{StaticResource SuccessColor}"
                                TextColor="White"
                                FontAttributes="Bold"
                                CornerRadius="8"/>
                    </Grid>
                </StackLayout>
            </Border>

            <!-- Lista de tipos existentes -->
            <Label Text="Tipos Registrados"
                   FontSize="16"
                   FontAttributes="Bold"
                   TextColor="{StaticResource DarkGray}"
                   Margin="10,10,10,5"/>

            <CollectionView ItemsSource="{Binding TiposEnfermedad}">
                <CollectionView.EmptyView>
                    <StackLayout Padding="50" VerticalOptions="Center">
                        <Label Text="ðŸ¥"
                               FontSize="48"
                               HorizontalOptions="Center"/>
                        <Label Text="No hay tipos de enfermedad registrados"
                               FontSize="16"
                               TextColor="{StaticResource MediumGray}"
                               HorizontalOptions="Center"
                               Margin="0,10,0,0"/>
                    </StackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource CardStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Icono -->
                                <Border Grid.Column="0"
                                        BackgroundColor="{StaticResource LightGray}"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 20"
                                        WidthRequest="40"
                                        HeightRequest="40"
                                        VerticalOptions="Center">
                                    <Label Text="ðŸ“‹"
                                           FontSize="20"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"/>
                                </Border>

                                <!-- Nombre -->
                                <Label Grid.Column="1"
                                       Text="{Binding NombreEnfermedad}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource DarkGray}"
                                       VerticalOptions="Center"
                                       Margin="15,0"/>

                                <!-- ID -->
                                <Border Grid.Column="2"
                                        BackgroundColor="{StaticResource LightGray}"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 12"
                                        Padding="10,5"
                                        VerticalOptions="Center">
                                    <Label Text="{Binding IdTipoEnfermedad, StringFormat='ID: {0}'}"
                                           FontSize="12"
                                           TextColor="{StaticResource MediumGray}"
                                           FontAttributes="Bold"/>
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Indicador de carga -->
            <ActivityIndicator IsRunning="{Binding IsCargando}"
                               IsVisible="{Binding IsCargando}"
                               Color="{StaticResource PrimaryColor}"
                               WidthRequest="50"
                               HeightRequest="50"
                               Margin="0,20"/>

        </StackLayout>
    </ScrollView>
</ContentPage>