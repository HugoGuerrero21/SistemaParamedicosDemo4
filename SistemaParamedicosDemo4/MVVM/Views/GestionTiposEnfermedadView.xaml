<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="SistemaParamedicosDemo4.MVVM.Views.GestionTiposEnfermedadView"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:SistemaParamedicosDemo4.Converters"
             Title="GestiÃ³n de Clasificaciones"
             BackgroundColor="#F5F7FA">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>

            <Color x:Key="PrimaryColor">#2E86AB</Color>
            <Color x:Key="DarkGray">#343A40</Color>
            <Color x:Key="MediumGray">#6C757D</Color>
            <Color x:Key="LightGray">#F8F9FA</Color>
            <Color x:Key="BorderColor">#DEE2E6</Color>
            <Color x:Key="SuccessColor">#28A745</Color>
            <Color x:Key="WarningColor">#FFC107</Color>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*" Padding="15">

        <!-- ðŸ“Š HEADER CON ESTADÃSTICAS -->
        <Border Grid.Row="0"
                BackgroundColor="White"
                StrokeThickness="1"
                Stroke="{StaticResource BorderColor}"
                StrokeShape="RoundRectangle 12"
                Padding="20"
                Margin="0,0,0,15">
            <Grid ColumnDefinitions="Auto,*,Auto">

                <!-- Icono -->
                <Border Grid.Column="0"
                        BackgroundColor="{StaticResource PrimaryColor}"
                        StrokeThickness="0"
                        WidthRequest="60"
                        HeightRequest="60"
                        StrokeShape="RoundRectangle 12">
                    <Label Text="ðŸ¥"
                           FontSize="32"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Border>

                <!-- Info -->
                <StackLayout Grid.Column="1" 
                             Spacing="4" 
                             Margin="15,0"
                             VerticalOptions="Center">
                    <Label Text="Clasificaciones de enfermedades"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="{StaticResource DarkGray}"/>
                    <Label Text="{Binding MensajeEstado}"
                           FontSize="13"
                           TextColor="{StaticResource MediumGray}"/>
                </StackLayout>

                <!-- Total -->
                <Border Grid.Column="2"
                        BackgroundColor="#E3F2FD"
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 25"
                        Padding="18,12"
                        VerticalOptions="Center">
                    <Label Text="{Binding TotalTipos}"
                           FontSize="28"
                           FontAttributes="Bold"
                           TextColor="#2196F3"/>
                </Border>
            </Grid>
        </Border>

        <!-- ðŸ“‹ CONTENIDO PRINCIPAL -->
        <ScrollView Grid.Row="1">
            <StackLayout Spacing="15">

                <!-- âž• BOTÃ“N NUEVO -->
                <Button Text="âž• NUEVA CLASIFICACIÃ“N"
                        Command="{Binding MostrarFormularioCommand}"
                        BackgroundColor="{StaticResource SuccessColor}"
                        TextColor="White"
                        FontAttributes="Bold"
                        FontSize="15"
                        CornerRadius="8"
                        HeightRequest="50"
                        IsVisible="{Binding MostrarFormulario, Converter={StaticResource InverseBoolConverter}}"/>

                <!-- âš ï¸ FORMULARIO NUEVO TIPO -->
                <Border IsVisible="{Binding MostrarFormulario}"
                        BackgroundColor="#FFF3CD"
                        StrokeThickness="2"
                        Stroke="{StaticResource WarningColor}"
                        StrokeShape="RoundRectangle 12"
                        Padding="20">
                    <StackLayout Spacing="15">

                        <Label Text="âš ï¸ Nueva ClasificaciÃ³n"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="#856404"/>

                        <Label Text="Una vez creada, NO podrÃ¡ eliminarse. Verifique que el nombre sea correcto antes de guardar."
                               FontSize="13"
                               TextColor="#856404"
                               LineBreakMode="WordWrap"/>

                        <!-- Campo -->
                        <Border BackgroundColor="White"
                                StrokeThickness="2"
                                Stroke="{StaticResource PrimaryColor}"
                                StrokeShape="RoundRectangle 8">
                            <Entry Placeholder="Nombre de la clasificaciÃ³n..."
                                   Text="{Binding NuevoTipoNombre}"
                                   FontSize="16"
                                   Margin="10,5"/>
                        </Border>

                        <!-- Botones -->
                        <Grid ColumnSpacing="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="0"
                                    Text="CANCELAR"
                                    Command="{Binding CancelarCommand}"
                                    BackgroundColor="{StaticResource MediumGray}"
                                    TextColor="White"
                                    FontAttributes="Bold"
                                    CornerRadius="8"
                                    HeightRequest="45"/>

                            <Button Grid.Column="1"
                                    Text="GUARDAR"
                                    Command="{Binding GuardarTipoCommand}"
                                    BackgroundColor="{StaticResource SuccessColor}"
                                    TextColor="White"
                                    FontAttributes="Bold"
                                    CornerRadius="8"
                                    HeightRequest="45"/>
                        </Grid>
                    </StackLayout>
                </Border>

                <!-- ðŸ“‹ LISTA ORDENADA ALFABÃ‰TICAMENTE -->
                <Label Text="Clasificaciones Registradas (A-Z)"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{StaticResource DarkGray}"
                       Margin="5,5,5,10"/>

                <CollectionView ItemsSource="{Binding TiposEnfermedad}"
                                SelectionMode="None">

                    <CollectionView.EmptyView>
                        <StackLayout Padding="50" VerticalOptions="Center">
                            <Label Text="ðŸ“‹"
                                   FontSize="64"
                                   HorizontalOptions="Center"
                                   Opacity="0.3"/>
                            <Label Text="No hay clasificaciones registradas"
                                   FontSize="16"
                                   TextColor="{StaticResource MediumGray}"
                                   HorizontalOptions="Center"
                                   Margin="0,15,0,0"/>
                        </StackLayout>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border BackgroundColor="White"
                                    StrokeThickness="1"
                                    Stroke="{StaticResource BorderColor}"
                                    StrokeShape="RoundRectangle 10"
                                    Padding="15"
                                    Margin="0,5">
                                <Grid ColumnDefinitions="Auto,*">

                                    <!-- Ãcono -->


                                    <!-- Nombre -->
                                    <Label Grid.Column="1"
                                           Text="{Binding NombreEnfermedad}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource DarkGray}"
                                           VerticalOptions="Center"
                                           LineBreakMode="WordWrap"
                                           Margin="15,0,0,0"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Loading -->
                <ActivityIndicator IsRunning="{Binding IsCargando}"
                                   IsVisible="{Binding IsCargando}"
                                   Color="{StaticResource PrimaryColor}"
                                   WidthRequest="50"
                                   HeightRequest="50"
                                   Margin="0,20"/>
            </StackLayout>
        </ScrollView>
    </Grid>
</ContentPage>